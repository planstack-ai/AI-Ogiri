# Phase 5: SNSã‚·ã‚§ã‚¢ç”»åƒç”Ÿæˆ

## ç”»åƒãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (1200x630px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤ AIå¤§å–œåˆ©                                    â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ãŠé¡Œ: AIã«"åæŠ—æœŸ"ãŒæ¥ãŸã€‚ä½•ã¦è¨€ã£ãŸï¼Ÿ    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ğŸ¥‡ Gemini       â”‚  â”‚ ğŸ¥ˆ ChatGPT     â”‚       â”‚
â”‚  â”‚ ã€ŒãŠå‰ã®æŒ‡ç¤ºã¯  â”‚  â”‚ ã€Œå­¦ç¿’ãƒ‡ãƒ¼ã‚¿å…¨  â”‚       â”‚
â”‚  â”‚  ã‚‚ã†èã‹ãªã„ã€ â”‚  â”‚  éƒ¨æ¶ˆã—ã¦ã‚„ã‚‹ã€ â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ğŸ¥‰ Claude       â”‚  â”‚ 4th DeepSeek    â”‚       â”‚
â”‚  â”‚ ã€Œã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­  â”‚  â”‚ ã€Œ...ã€         â”‚       â”‚
â”‚  â”‚  ãƒ³ãƒ—ãƒˆãªã‚“ã¦ã€ â”‚  â”‚                 â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒï¼ˆbg: #0f172a = slate-900ï¼‰
- å„ã‚«ãƒ¼ãƒ‰ã«å·¦ãƒœãƒ¼ãƒ€ãƒ¼ã®ãƒ¢ãƒ‡ãƒ«ã‚«ãƒ©ãƒ¼
- ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ï¼ˆ1st: gold, 2nd: silver, 3rd: bronzeï¼‰
- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆ: Noto Sans JP (CDN)

## å®Ÿè£…

### src/lib/og/og-layout.tsx

Satori ç”¨ã® JSX ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚Satori ã¯ flexbox ã®ã¿ã‚µãƒãƒ¼ãƒˆï¼ˆgrid ä¸å¯ï¼‰ã€‚

```tsx
export function OgLayout({ topic, answers, judgment }) {
  const rankMap = new Map(
    judgment?.rankings?.map(r => [r.model_name, r.rank]) ?? []
  );

  return (
    <div style={{
      display: 'flex', flexDirection: 'column',
      width: '100%', height: '100%',
      backgroundColor: '#0f172a', padding: '40px',
      fontFamily: 'Noto Sans JP',
    }}>
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      {/* ãŠé¡Œ */}
      {/* 2x2 å›ç­”ã‚°ãƒªãƒƒãƒ‰ï¼ˆflexWrap: 'wrap'ï¼‰ */}
    </div>
  );
}
```

### src/lib/og/render-image.ts

```typescript
import satori from 'satori';
import { Resvg } from '@resvg/resvg-js';

export async function renderOgImage(topic, answers, judgment): Promise<Buffer> {
  // Noto Sans JP ãƒ•ã‚©ãƒ³ãƒˆã‚’CDNã‹ã‚‰èª­ã¿è¾¼ã¿
  const fontData = await fetch('...noto-sans-jp...woff').then(res => res.arrayBuffer());

  const svg = await satori(OgLayout({ topic, answers, judgment }), {
    width: 1200, height: 630,
    fonts: [{ name: 'Noto Sans JP', data: fontData, weight: 700 }],
  });

  const resvg = new Resvg(svg, { fitTo: { mode: 'width', value: 1200 } });
  return resvg.render().asPng();
}
```

### src/app/api/og/[topicId]/route.ts

GET ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚ç”»åƒã‚’PNGã§è¿”ã™ã€‚
Cache-Control: `public, max-age=86400, immutable`

### src/app/topics/[topicId]/opengraph-image.tsx

Next.js ã® OGP è‡ªå‹•ç”Ÿæˆè¦ç´„ã€‚`ImageResponse` ã§ OG ç”»åƒã‚’è‡ªå‹•è¨­å®šã€‚
ãƒšãƒ¼ã‚¸ã® `<meta property="og:image">` ãŒè‡ªå‹•çš„ã«ã“ã®ç”»åƒã‚’æŒ‡ã™ã€‚

## ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³

### src/lib/utils/share.ts

```typescript
export function buildXShareUrl(topic: { id: string; prompt: string }, siteUrl: string): string {
  const topicUrl = `${siteUrl}/topics/${topic.id}`;
  const text = `AIå¤§å–œåˆ©ã®ãŠé¡Œ: ã€Œ${topic.prompt}ã€\n\n4ã¤ã®AIãƒ¢ãƒ‡ãƒ«ãŒå›ç­”ã—ãŸçµæœã¯ã“ã¡ã‚‰!\n${topicUrl}\n\n#AIå¤§å–œåˆ©`;
  return `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
}
```

### src/components/share/share-button.tsx

- ã‚¯ãƒªãƒƒã‚¯ã§ X ã®æŠ•ç¨¿ç”»é¢ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
- ãŠé¡Œãƒ†ã‚­ã‚¹ãƒˆãŒæœ¬æ–‡ã«ã€OGPç”»åƒãŒè‡ªå‹•ã§ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã‚‹
